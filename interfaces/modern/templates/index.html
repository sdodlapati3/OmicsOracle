<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmicsOracle - {{ title_suffix if title_suffix else 'Modern Interface' }}</title>
    
    <!-- Modernized CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß¨ OmicsOracle</h1>
            <p>{{ subtitle if subtitle else 'Modern Interface' }}</p>
        </div>

        <div class="status {{ 'available' if omics_available else 'unavailable' }}">
            {% if omics_available %}
                ‚úÖ <strong>Fully Functional</strong> - Connected to OmicsOracle pipeline
            {% else %}
                ‚ö†Ô∏è <strong>Limited Mode</strong> - OmicsOracle pipeline not available
            {% endif %}
        </div>

        <div class="content">
            <form class="search-form" id="searchForm" method="post" action="/search">
                <div class="form-group">
                    <label for="query">Search Query</label>
                    <div class="search-container">
                        <input type="text" id="query" name="query"
                               placeholder="e.g., BRCA1 breast cancer, RNA-seq brain tumor..."
                               autocomplete="off"
                               value="{{ query if query else '' }}"
                               required>
                        <div id="searchSuggestions" class="search-suggestions"></div>
                    </div>
                </div>

                <!-- Quick Filters -->
                <div class="quick-filters">
                    <span class="quick-filters-label">Quick search topics:</span>
                    <div class="filter-tags" id="quickFilters">
                        <!-- Quick filter tags will be loaded here -->
                    </div>
                </div>

                <!-- Search Helpers -->
                <div class="search-helpers">
                    <span class="example-searches" id="showExamples">View example searches</span>
                    <span class="search-history" id="showHistory">Recent searches</span>
                </div>

                <!-- Hidden fields for pagination -->
                <input type="hidden" id="max_results" name="max_results" value="{{ max_results if max_results else 10 }}">
                <input type="hidden" id="page" name="page" value="{{ page if page else 1 }}">
                <input type="hidden" id="page_size" name="page_size" value="{{ page_size if page_size else 10 }}">

                <button type="submit" class="btn" id="searchBtn">
                    üîç Search Datasets
                </button>
            </form>

            <div id="results" class="results {{ 'show' if results else '' }}">
                {% if results %}
                    <!-- Server-side rendered results for non-JS fallback -->
                    {% if results.results and results.results|length > 0 %}
                        <div class="success">
                            {% set total_count = results.pagination.total_results if results.pagination else results.results|length %}
                            ‚úÖ Found {{ total_count }} dataset{{ 's' if total_count != 1 else '' }}
                        </div>
                        
                        {% for result in results.results %}
                        <div class="result-item" data-geo-id="{{ result.id }}" data-result-id="{{ result.id }}">
                            <div class="result-number">{{ loop.index }}</div>
                            <div class="result-header">
                                <div class="result-title">
                                    <span class="expand-icon">‚ñ∂</span>
                                    {{ result.title }}
                                </div>
                            </div>
                            <div class="result-meta">
                                {% if result.ai_enhanced %}
                                    <span class="meta-badge ai-enhanced">ü§ñ AI Enhanced</span>
                                {% endif %}
                                {% if result.organism and result.organism != 'Unknown' %}
                                    <span class="meta-badge organism">{{ result.organism }}</span>
                                {% endif %}
                                {% if result.sample_count and result.sample_count != 'Unknown' %}
                                    <span class="meta-badge samples">{{ result.sample_count }} samples</span>
                                {% endif %}
                                {% if result.platform and result.platform != 'Unknown' %}
                                    <span class="meta-badge platform">{{ result.platform }}</span>
                                {% endif %}
                                <span class="meta-badge">ID: {{ result.id }}</span>
                            </div>
                            <div class="result-summary collapsed">{{ result.summary }}</div>
                            
                            <div class="result-details">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Dataset ID</div>
                                        <div class="detail-value">{{ result.id }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Organism</div>
                                        <div class="detail-value">{{ result.organism if result.organism else 'Unknown' }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Sample Count</div>
                                        <div class="detail-value">{{ result.sample_count if result.sample_count else 'Unknown' }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Platform</div>
                                        <div class="detail-value">{{ result.platform if result.platform else 'Unknown' }}</div>
                                    </div>
                                </div>
                                
                                <div class="result-actions">
                                    {% if result.id and result.id != 'unknown' %}
                                        <button class="btn-action primary" onclick="showSamples('{{ result.id }}', event)">üìã View Samples</button>
                                    {% endif %}
                                    
                                    {% if result.id and result.id.startswith('GSE') %}
                                        <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc={{ result.id }}" target="_blank" rel="noopener" class="btn-action">üîó View on GEO</a>
                                    {% endif %}
                                    
                                    <button class="btn-action" onclick="saveToFavorites('{{ result.id }}', event)">‚≠ê Save</button>
                                    <button class="btn-action" onclick="exportResult('{{ result.id }}', event)">üì• Export</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="error">No datasets found for your query. Try different keywords.</div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Modern JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
